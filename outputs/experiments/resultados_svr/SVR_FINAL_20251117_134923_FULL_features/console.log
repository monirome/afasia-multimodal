[2025-11-17 13:49:23] [INFO] ======================================================================
[2025-11-17 13:49:23] [INFO] SVR COMPLETO FINAL - FULL FEATURES
[2025-11-17 13:49:23] [INFO] ======================================================================
[2025-11-17 13:49:23] [INFO] Output: /lhome/ext/upc150/upc1503/afasia_cat/codigos_julio2025/outputs/experiments/resultados_svr/SVR_FINAL_20251117_134923_FULL_features
[2025-11-17 13:49:23] [INFO] SHAP disponible: SI
[2025-11-17 13:49:23] [INFO] 
======================================================================
[2025-11-17 13:49:23] [INFO] CARGANDO DATOS
[2025-11-17 13:49:23] [INFO] ======================================================================
[2025-11-17 13:49:23] [INFO] Total registros: 506
[2025-11-17 13:49:23] [INFO] 
Pacientes ES (TCU) antes del parche:
[2025-11-17 13:49:23] [INFO] 
patient_id language group   QA
    TCU02a       es   pwa 77.3
    TCU04a       es   pwa 83.8
    TCU06a       es   NaN 62.6
    TCU10a       es   NaN 77.6
[2025-11-17 13:49:23] [INFO] 
Pacientes ES (TCU) después del parche:
[2025-11-17 13:49:23] [INFO] 
patient_id language group   QA
    TCU02a       es   pwa 77.3
    TCU04a       es   pwa 83.8
    TCU06a       es   pwa 62.6
    TCU10a       es   pwa 77.6
[2025-11-17 13:49:23] [INFO] Con QA valido: 506
[2025-11-17 13:49:23] [INFO] 
Distribucion por idioma:
[2025-11-17 13:49:23] [INFO]   en: 502
[2025-11-17 13:49:23] [INFO]   es: 4
[2025-11-17 13:49:23] [INFO] 
======================================================================
[2025-11-17 13:49:23] [INFO] SPLIT
[2025-11-17 13:49:23] [INFO] ======================================================================
[2025-11-17 13:49:23] [INFO] 
Split:
[2025-11-17 13:49:23] [INFO]   PWA:     423
[2025-11-17 13:49:23] [INFO]   Control: 70
[2025-11-17 13:49:23] [WARNING] 
NO se encontró columna de sub-dataset (subdataset_paper / subdataset / subset). Se usará GroupKFold sin estratificación por sub-dataset.
[2025-11-17 13:49:23] [INFO] 
Por idioma (PWA):
[2025-11-17 13:49:23] [INFO]   EN (train): 419
[2025-11-17 13:49:23] [INFO]   ES (eval):  4
[2025-11-17 13:49:23] [INFO] 
======================================================================
[2025-11-17 13:49:23] [INFO] FEATURES
[2025-11-17 13:49:23] [INFO] ======================================================================
[2025-11-17 13:49:23] [INFO] 
Features:
[2025-11-17 13:49:23] [INFO]   DEN: 42
[2025-11-17 13:49:23] [INFO]   DYS: 22
[2025-11-17 13:49:23] [INFO]   LEX: 1
[2025-11-17 13:49:23] [INFO]   TOTAL: 65
[2025-11-17 13:49:23] [INFO] 
======================================================================
[2025-11-17 13:49:23] [INFO] CROSS-VALIDATION (EN) - GroupKFold por paciente (sin estratificación por sub-dataset)
[2025-11-17 13:49:23] [INFO] ======================================================================
[2025-11-17 13:49:23] [INFO] 
  Fold 1/4:
[2025-11-17 13:49:27] [INFO]     MAE: 16.034
[2025-11-17 13:49:27] [INFO] 
  Fold 2/4:
[2025-11-17 13:49:27] [INFO]     MAE: 13.181
[2025-11-17 13:49:27] [INFO] 
  Fold 3/4:
[2025-11-17 13:49:28] [INFO]     MAE: 14.022
[2025-11-17 13:49:28] [INFO] 
  Fold 4/4:
[2025-11-17 13:49:28] [INFO]     MAE: 15.252
[2025-11-17 13:49:28] [INFO] 
======================================================================
[2025-11-17 13:49:28] [INFO] EVALUACION: CV_PWA
[2025-11-17 13:49:28] [INFO] ======================================================================
[2025-11-17 13:49:28] [INFO] Metricas de regresion:
[2025-11-17 13:49:28] [INFO]   MAE:        14.621
[2025-11-17 13:49:28] [INFO]   RMSE:       19.662
[2025-11-17 13:49:28] [INFO]   R²:         0.315
[2025-11-17 13:49:28] [INFO]   Pearson r:  0.592 (p=0.0000)
[2025-11-17 13:49:28] [INFO]   Spearman:   0.601 (p=0.0000)
[2025-11-17 13:49:28] [INFO] 
Accuracy por distancia:
[2025-11-17 13:49:28] [INFO]   Acc@1:  4.53%
[2025-11-17 13:49:28] [INFO]   Acc@5:  25.54%
[2025-11-17 13:49:28] [INFO]   Acc@10: 47.73%
[2025-11-17 13:49:28] [INFO]   Exact:  0.48%
[2025-11-17 13:49:28] [INFO] 
Clasificacion por severidad:
[2025-11-17 13:49:28] [INFO]   Accuracy: 51.07%
[2025-11-17 13:49:28] [INFO] 
  Por clase:
[2025-11-17 13:49:28] [INFO]     Very Severe: Prec=100.00%, Rec=9.09%, F1=16.67%
[2025-11-17 13:49:28] [INFO]     Severe: Prec=19.30%, Rec=20.00%, F1=19.64%
[2025-11-17 13:49:28] [INFO]     Moderate: Prec=45.93%, Rec=61.54%, F1=52.60%
[2025-11-17 13:49:28] [INFO]     Mild: Prec=69.13%, Rec=62.80%, F1=65.81%
[2025-11-17 13:49:28] [INFO] 
Generando graficos...
[2025-11-17 13:49:29] [INFO] Guardados: CV_PWA_*.csv/png
[2025-11-17 13:49:29] [INFO] 
======================================================================
[2025-11-17 13:49:29] [INFO] CALIBRACION
[2025-11-17 13:49:29] [INFO] ======================================================================
[2025-11-17 13:49:29] [INFO] 
======================================================================
[2025-11-17 13:49:29] [INFO] EVALUACION: CV_PWA_CALIBRATED
[2025-11-17 13:49:29] [INFO] ======================================================================
[2025-11-17 13:49:29] [INFO] Metricas de regresion:
[2025-11-17 13:49:29] [INFO]   MAE:        13.908
[2025-11-17 13:49:29] [INFO]   RMSE:       18.199
[2025-11-17 13:49:29] [INFO]   R²:         0.413
[2025-11-17 13:49:29] [INFO]   Pearson r:  0.643 (p=0.0000)
[2025-11-17 13:49:29] [INFO]   Spearman:   0.626 (p=0.0000)
[2025-11-17 13:49:29] [INFO] 
Accuracy por distancia:
[2025-11-17 13:49:29] [INFO]   Acc@1:  5.25%
[2025-11-17 13:49:29] [INFO]   Acc@5:  25.06%
[2025-11-17 13:49:29] [INFO]   Acc@10: 47.97%
[2025-11-17 13:49:29] [INFO]   Exact:  0.24%
[2025-11-17 13:49:29] [INFO] 
Clasificacion por severidad:
[2025-11-17 13:49:29] [INFO]   Accuracy: 51.31%
[2025-11-17 13:49:29] [INFO] 
  Por clase:
[2025-11-17 13:49:29] [INFO]     Very Severe: Prec=100.00%, Rec=11.36%, F1=20.41%
[2025-11-17 13:49:29] [INFO]     Severe: Prec=22.22%, Rec=43.64%, F1=29.45%
[2025-11-17 13:49:29] [INFO]     Moderate: Prec=51.02%, Rec=48.08%, F1=49.50%
[2025-11-17 13:49:29] [INFO]     Mild: Prec=69.81%, Rec=67.68%, F1=68.73%
[2025-11-17 13:49:29] [INFO] 
Generando graficos...
[2025-11-17 13:49:30] [INFO] Guardados: CV_PWA_CALIBRATED_*.csv/png
[2025-11-17 13:49:30] [INFO] 
======================================================================
[2025-11-17 13:49:30] [INFO] ANÁLISIS DE ERROR (Como Figura 6 del paper)
[2025-11-17 13:49:30] [INFO] ======================================================================
[2025-11-17 13:49:30] [INFO] 
======================================================================
[2025-11-17 13:49:30] [INFO] ANÁLISIS POR GRUPOS DE ERROR (Threshold=5.316)
[2025-11-17 13:49:30] [INFO] ======================================================================
[2025-11-17 13:49:30] [INFO] 
Grupo Low Errors:
[2025-11-17 13:49:30] [INFO]   N:          110
[2025-11-17 13:49:30] [INFO]   MAE:        2.64 ± 1.52
[2025-11-17 13:49:30] [INFO]   QA real:    65.8 ± 18.5
[2025-11-17 13:49:30] [INFO] 
Grupo High Errors:
[2025-11-17 13:49:30] [INFO]   N:          309
[2025-11-17 13:49:30] [INFO]   MAE:        17.92 ± 11.17
[2025-11-17 13:49:30] [INFO]   QA real:    63.2 ± 25.3
[2025-11-17 13:49:30] [INFO] 
Diferencia en QA real entre grupos:
[2025-11-17 13:49:30] [INFO]   t-statistic: 1.129
[2025-11-17 13:49:30] [INFO]   p-value:     0.2600
[2025-11-17 13:49:30] [INFO] 
Guardado: error_histogram.png, error_groups_analysis.csv
[2025-11-17 13:49:30] [INFO] 
======================================================================
[2025-11-17 13:49:30] [INFO] MODELO FINAL
[2025-11-17 13:49:30] [INFO] ======================================================================
[2025-11-17 13:49:30] [INFO] Entrenando con: 419 PWA EN + 70 Control
[2025-11-17 13:49:31] [INFO] Mejores parámetros:
[2025-11-17 13:49:31] [INFO]   svr__C: 10
[2025-11-17 13:49:31] [INFO]   svr__epsilon: 0.01
[2025-11-17 13:49:31] [INFO]   svr__gamma: auto
[2025-11-17 13:49:31] [INFO]   svr__kernel: rbf
[2025-11-17 13:49:31] [INFO] 
======================================================================
[2025-11-17 13:49:31] [INFO] INTERPRETABILIDAD
[2025-11-17 13:49:31] [INFO] ======================================================================
[2025-11-17 13:49:31] [INFO] 
======================================================================
[2025-11-17 13:49:31] [INFO] PERMUTATION IMPORTANCE
[2025-11-17 13:49:31] [INFO] ======================================================================
[2025-11-17 13:49:31] [INFO] Calculando (n_repeats=10)...
[2025-11-17 13:49:42] [INFO] 
Top 20 features:
[2025-11-17 13:49:42] [INFO]    1. lex_ttr                                  1.4659 +/- 0.1756
[2025-11-17 13:49:42] [INFO]    2. den_determiners                          1.1436 +/- 0.1364
[2025-11-17 13:49:42] [INFO]    3. den_function_words                       0.9458 +/- 0.1201
[2025-11-17 13:49:42] [INFO]    4. den_prepositions                         0.6931 +/- 0.0748
[2025-11-17 13:49:42] [INFO]    5. den_OCW                                  0.5951 +/- 0.0346
[2025-11-17 13:49:42] [INFO]    6. den_adjectives                           0.5417 +/- 0.0275
[2025-11-17 13:49:42] [INFO]    7. dys_short_pauses_per_min                 0.5388 +/- 0.0920
[2025-11-17 13:49:42] [INFO]    8. den_W                                    0.5256 +/- 0.0430
[2025-11-17 13:49:42] [INFO]    9. dys_fillers_per_phone                    0.4999 +/- 0.0693
[2025-11-17 13:49:42] [INFO]   10. dys_fillers_per_word                     0.4996 +/- 0.0693
[2025-11-17 13:49:42] [INFO]   11. dys_pauses_per_min                       0.4653 +/- 0.1106
[2025-11-17 13:49:42] [INFO]   12. den_verbs                                0.4197 +/- 0.0730
[2025-11-17 13:49:42] [INFO]   13. dys_long_pauses_per_min                  0.4039 +/- 0.1160
[2025-11-17 13:49:42] [INFO]   14. den_light_verbs                          0.3941 +/- 0.0539
[2025-11-17 13:49:42] [INFO]   15. den_phones_utt_q1                        0.3567 +/- 0.0296
[2025-11-17 13:49:42] [INFO]   16. den_words_utt_q1                         0.3485 +/- 0.0307
[2025-11-17 13:49:42] [INFO]   17. den_nouns                                0.3264 +/- 0.0345
[2025-11-17 13:49:42] [INFO]   18. den_phones_utt_iqr                       0.3198 +/- 0.0384
[2025-11-17 13:49:42] [INFO]   19. den_words_utt_iqr                        0.3140 +/- 0.0379
[2025-11-17 13:49:42] [INFO]   20. den_pronoun_ratio                        0.3134 +/- 0.0206
[2025-11-17 13:49:42] [INFO] 
Guardado: feature_importance_permutation.csv/png
[2025-11-17 13:49:42] [INFO] 
======================================================================
[2025-11-17 13:49:42] [INFO] ANALISIS POR GRUPOS (Permutation)
[2025-11-17 13:49:42] [INFO] ======================================================================
[2025-11-17 13:49:42] [INFO] 
Importancia por grupo:
[2025-11-17 13:49:42] [INFO]   Grupo         Total      Media    Count    % Total
[2025-11-17 13:49:42] [INFO]   ------------------------------------------------------------
[2025-11-17 13:49:42] [INFO]   DEN         13.8782     0.3304       42      64.9%
[2025-11-17 13:49:42] [INFO]   DYS          6.0516     0.2751       22      28.3%
[2025-11-17 13:49:42] [INFO]   LEX          1.4659     1.4659        1       6.9%
[2025-11-17 13:49:43] [INFO] 
Guardado: feature_importance_by_group_permutation.csv/png
[2025-11-17 13:49:43] [INFO] 
======================================================================
[2025-11-17 13:49:43] [INFO] SHAP VALUES
[2025-11-17 13:49:43] [INFO] ======================================================================
[2025-11-17 13:49:43] [INFO] Calculando SHAP values...
[2025-11-17 13:49:43] [INFO]   Usando 100 samples random como background
[2025-11-17 13:49:43] [INFO]   Creando SHAP explainer...
[2025-11-17 13:49:43] [INFO]   Calculando SHAP para 83 samples de test...
[2025-11-17 14:00:08] [INFO] 
Top 20 features (SHAP):
[2025-11-17 14:00:08] [INFO]    1. den_function_words                       1.7294
[2025-11-17 14:00:08] [INFO]    2. den_determiners                          1.6740
[2025-11-17 14:00:08] [INFO]    3. den_prepositions                         1.3690
[2025-11-17 14:00:08] [INFO]    4. lex_ttr                                  1.3127
[2025-11-17 14:00:08] [INFO]    5. den_light_verbs                          0.6973
[2025-11-17 14:00:08] [INFO]    6. den_OCW                                  0.6955
[2025-11-17 14:00:08] [INFO]    7. den_verbs                                0.6263
[2025-11-17 14:00:08] [INFO]    8. dys_short_pauses_per_min                 0.6190
[2025-11-17 14:00:08] [INFO]    9. dys_fillers_per_phone                    0.5945
[2025-11-17 14:00:08] [INFO]   10. dys_fillers_per_word                     0.5657
[2025-11-17 14:00:08] [INFO]   11. dys_pause_sec_max                        0.4253
[2025-11-17 14:00:08] [INFO]   12. dys_pauses_per_min                       0.3757
[2025-11-17 14:00:08] [INFO]   13. den_W                                    0.3490
[2025-11-17 14:00:08] [INFO]   14. den_adjectives                           0.3225
[2025-11-17 14:00:08] [INFO]   15. dys_pause_sec_p10                        0.2579
[2025-11-17 14:00:08] [INFO]   16. dys_pause_sec_p90                        0.2363
[2025-11-17 14:00:08] [INFO]   17. den_noun_ratio                           0.2299
[2025-11-17 14:00:08] [INFO]   18. den_phones_utt_iqr                       0.1901
[2025-11-17 14:00:08] [INFO]   19. den_words_utt_iqr                        0.1680
[2025-11-17 14:00:08] [INFO]   20. dys_long_pauses_per_min                  0.1599
[2025-11-17 14:00:08] [INFO] 
Generando graficos SHAP...
[2025-11-17 14:00:09] [INFO]   Guardado: shap_summary_*.png
[2025-11-17 14:00:09] [INFO] Guardado: shap_values.csv, feature_importance_shap.csv
[2025-11-17 14:00:09] [INFO] 
======================================================================
[2025-11-17 14:00:09] [INFO] ANALISIS POR GRUPOS (SHAP)
[2025-11-17 14:00:09] [INFO] ======================================================================
[2025-11-17 14:00:09] [INFO] 
Importancia por grupo:
[2025-11-17 14:00:09] [INFO]   Grupo         Total      Media    Count    % Total
[2025-11-17 14:00:09] [INFO]   ------------------------------------------------------------
[2025-11-17 14:00:09] [INFO]   DEN          8.8893     0.2117       42      62.4%
[2025-11-17 14:00:09] [INFO]   DYS          4.0431     0.1838       22      28.4%
[2025-11-17 14:00:09] [INFO]   LEX          1.3127     1.3127        1       9.2%
[2025-11-17 14:00:10] [INFO] 
Guardado: feature_importance_by_group_shap.csv/png
[2025-11-17 14:00:10] [INFO] 
======================================================================
[2025-11-17 14:00:10] [INFO] EVALUACION ESPAÑOL
[2025-11-17 14:00:10] [INFO] ======================================================================
[2025-11-17 14:00:10] [INFO] Evaluando 4 pacientes españoles...
[2025-11-17 14:00:10] [INFO] 
======================================================================
[2025-11-17 14:00:10] [INFO] EVALUACION: EVAL_ES_RAW
[2025-11-17 14:00:10] [INFO] ======================================================================
[2025-11-17 14:00:10] [INFO] Metricas de regresion:
[2025-11-17 14:00:10] [INFO]   MAE:        9.502
[2025-11-17 14:00:10] [INFO]   RMSE:       11.301
[2025-11-17 14:00:10] [INFO]   R²:         -1.104
[2025-11-17 14:00:10] [INFO]   Pearson r:  0.688 (p=0.3122)
[2025-11-17 14:00:10] [INFO]   Spearman:   0.400 (p=0.6000)
[2025-11-17 14:00:10] [INFO] 
Accuracy por distancia:
[2025-11-17 14:00:10] [INFO]   Acc@1:  25.00%
[2025-11-17 14:00:10] [INFO]   Acc@5:  25.00%
[2025-11-17 14:00:10] [INFO]   Acc@10: 50.00%
[2025-11-17 14:00:10] [INFO]   Exact:  0.00%
[2025-11-17 14:00:10] [INFO] 
Clasificacion por severidad:
[2025-11-17 14:00:10] [INFO]   Accuracy: 50.00%
[2025-11-17 14:00:10] [INFO] 
  Por clase:
[2025-11-17 14:00:10] [INFO]     Very Severe: Prec=0.00%, Rec=0.00%, F1=0.00%
[2025-11-17 14:00:10] [INFO]     Severe: Prec=0.00%, Rec=0.00%, F1=0.00%
[2025-11-17 14:00:10] [INFO]     Moderate: Prec=33.33%, Rec=100.00%, F1=50.00%
[2025-11-17 14:00:10] [INFO]     Mild: Prec=100.00%, Rec=33.33%, F1=50.00%
[2025-11-17 14:00:10] [INFO] 
Generando graficos...
[2025-11-17 14:00:10] [INFO] Guardados: EVAL_ES_RAW_*.csv/png
[2025-11-17 14:00:10] [INFO] 
======================================================================
[2025-11-17 14:00:10] [INFO] EVALUACION: EVAL_ES_CALIBRATED
[2025-11-17 14:00:10] [INFO] ======================================================================
[2025-11-17 14:00:10] [INFO] Metricas de regresion:
[2025-11-17 14:00:10] [INFO]   MAE:        12.515
[2025-11-17 14:00:10] [INFO]   RMSE:       14.100
[2025-11-17 14:00:10] [INFO]   R²:         -2.275
[2025-11-17 14:00:10] [INFO]   Pearson r:  0.747 (p=0.2532)
[2025-11-17 14:00:10] [INFO]   Spearman:   0.400 (p=0.6000)
[2025-11-17 14:00:10] [INFO] 
Accuracy por distancia:
[2025-11-17 14:00:10] [INFO]   Acc@1:  0.00%
[2025-11-17 14:00:10] [INFO]   Acc@5:  25.00%
[2025-11-17 14:00:10] [INFO]   Acc@10: 25.00%
[2025-11-17 14:00:10] [INFO]   Exact:  0.00%
[2025-11-17 14:00:10] [INFO] 
Clasificacion por severidad:
[2025-11-17 14:00:10] [INFO]   Accuracy: 25.00%
[2025-11-17 14:00:10] [INFO] 
  Por clase:
[2025-11-17 14:00:10] [INFO]     Very Severe: Prec=0.00%, Rec=0.00%, F1=0.00%
[2025-11-17 14:00:10] [INFO]     Severe: Prec=0.00%, Rec=0.00%, F1=0.00%
[2025-11-17 14:00:10] [INFO]     Moderate: Prec=0.00%, Rec=0.00%, F1=0.00%
[2025-11-17 14:00:10] [INFO]     Mild: Prec=100.00%, Rec=33.33%, F1=50.00%
[2025-11-17 14:00:10] [INFO] 
Generando graficos...
[2025-11-17 14:00:11] [INFO] Guardados: EVAL_ES_CALIBRATED_*.csv/png
[2025-11-17 14:00:11] [INFO] 
======================================================================
[2025-11-17 14:00:11] [INFO] EVALUACION CATALÁN
[2025-11-17 14:00:11] [INFO] ======================================================================
[2025-11-17 14:00:11] [INFO] No hay datos en catalán para evaluar
[2025-11-17 14:00:11] [INFO] 
======================================================================
[2025-11-17 14:00:11] [INFO] PROCESO COMPLETADO
[2025-11-17 14:00:11] [INFO] ======================================================================
[2025-11-17 14:00:11] [INFO] Resultados guardados en: /lhome/ext/upc150/upc1503/afasia_cat/codigos_julio2025/outputs/experiments/resultados_svr/SVR_FINAL_20251117_134923_FULL_features
[2025-11-17 14:00:11] [INFO] 
Archivos generados:
[2025-11-17 14:00:11] [INFO]   - Modelo: model_final.pkl
[2025-11-17 14:00:11] [INFO]   - Calibrador: calibrator.pkl
[2025-11-17 14:00:11] [INFO]   - CV inglés: CV_PWA_*.csv/png
[2025-11-17 14:00:11] [INFO]   - CV calibrado: CV_PWA_CALIBRATED_*.csv/png
[2025-11-17 14:00:11] [INFO]   - Español: EVAL_ES_*.csv/png
[2025-11-17 14:00:11] [INFO]   - Interpretabilidad: feature_importance_*.csv/png
[2025-11-17 14:00:11] [INFO]   - SHAP: shap_values.csv, shap_summary_*.png
[2025-11-17 14:00:11] [INFO]   - Análisis de error: error_histogram.png, error_groups_analysis.csv
[2025-11-17 14:00:11] [INFO] 
======================================================================
[2025-11-17 14:00:11] [INFO] COMPARACIÓN CON LE ET AL. (2018)
[2025-11-17 14:00:11] [INFO] ======================================================================
[2025-11-17 14:00:11] [INFO] 
Resultados del paper (Table 9, Combined protocol):
[2025-11-17 14:00:11] [INFO]   MAE:        8.86 (Oracle) / 9.18 (Auto)
[2025-11-17 14:00:11] [INFO]   Correlación: .801 (Oracle) / .799 (Auto)
[2025-11-17 14:00:11] [INFO] 
Nuestros resultados (CV_PWA_CALIBRATED):
[2025-11-17 14:00:11] [INFO]   MAE:        13.91
[2025-11-17 14:00:11] [INFO]   Correlación: 0.643
[2025-11-17 14:00:11] [INFO] 
Diferencia con el paper:
[2025-11-17 14:00:11] [INFO]   ΔMAE:  +4.73 (peor)
[2025-11-17 14:00:11] [INFO]   ΔCorr: -0.156 (peor)
