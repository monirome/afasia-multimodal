[2025-10-30 11:04:39] [INFO] ======================================================================
[2025-10-30 11:04:39] [INFO] INICIO: Predicción WAB-AQ con features DEN+DYS
[2025-10-30 11:04:39] [INFO] Metodología: Le et al. (2018)
[2025-10-30 11:04:39] [INFO] ======================================================================
[2025-10-30 11:04:39] [INFO] Directorio de resultados: /lhome/ext/upc150/upc1503/afasia_cat/codigos_julio2025/resultados_svr/SVR_DEN_DYS_20251030_110439
[2025-10-30 11:04:39] [INFO] Timestamp: 20251030_110439
[2025-10-30 11:04:39] [INFO] Script copiado a resultados
[2025-10-30 11:04:39] [INFO] 
======================================================================
[2025-10-30 11:04:39] [INFO] CARGANDO DATOS
[2025-10-30 11:04:39] [INFO] ======================================================================
[2025-10-30 11:04:39] [INFO] Cargando dataset desde: /lhome/ext/upc150/upc1503/afasia_cat/codigos_julio2025/dataset_FINAL_den_dys_wab.csv
[2025-10-30 11:04:39] [INFO] Dataset cargado: 489 pacientes
[2025-10-30 11:04:39] [INFO] Columna 'language' renombrada a 'lang'
[2025-10-30 11:04:39] [INFO] Pacientes con QA válido: 489
[2025-10-30 11:04:39] [INFO] 
======================================================================
[2025-10-30 11:04:39] [INFO] PREPARANDO FEATURES
[2025-10-30 11:04:39] [INFO] ======================================================================
[2025-10-30 11:04:39] [INFO] Features detectadas:
[2025-10-30 11:04:39] [INFO]   DEN: 18
[2025-10-30 11:04:39] [INFO]   DYS: 10
[2025-10-30 11:04:39] [INFO]   TOTAL: 28
[2025-10-30 11:04:39] [INFO] Features numéricas finales: 28
[2025-10-30 11:04:39] [INFO] Lista de features guardada: features_used.txt
[2025-10-30 11:04:39] [INFO] 
======================================================================
[2025-10-30 11:04:39] [INFO] PREPARANDO SPLITS POR IDIOMA
[2025-10-30 11:04:39] [INFO] ======================================================================
[2025-10-30 11:04:39] [INFO] Distribución por idioma:
[2025-10-30 11:04:39] [INFO]   EN (train):               489 pacientes
[2025-10-30 11:04:39] [INFO]   ES (internal validation): 0 pacientes
[2025-10-30 11:04:39] [INFO]   CA (external test):       0 pacientes
[2025-10-30 11:04:39] [INFO] 
Datos de entrenamiento (EN):
[2025-10-30 11:04:39] [INFO]   X shape: (489, 28)
[2025-10-30 11:04:39] [INFO]   y shape: (489,)
[2025-10-30 11:04:39] [INFO]   Grupos únicos: 489
[2025-10-30 11:04:39] [INFO]   QA range: [0.2, 100.0]
[2025-10-30 11:04:39] [INFO]   QA mean ± std: 69.97 ± 23.26
[2025-10-30 11:04:39] [INFO] 
======================================================================
[2025-10-30 11:04:39] [INFO] CONFIGURACIÓN Y ENTRENAMIENTO DEL MODELO
[2025-10-30 11:04:39] [INFO] ======================================================================
[2025-10-30 11:04:39] [INFO] Pipeline:
[2025-10-30 11:04:39] [INFO]   1. SimpleImputer (strategy='median')
[2025-10-30 11:04:39] [INFO]   2. StandardScaler
[2025-10-30 11:04:39] [INFO]   3. SVR
[2025-10-30 11:04:39] [INFO] 
Hiperparámetros a explorar:
[2025-10-30 11:04:39] [INFO]   svr__C: [1, 10, 100]
[2025-10-30 11:04:39] [INFO]   svr__epsilon: [0.1, 1]
[2025-10-30 11:04:39] [INFO]   svr__kernel: ['rbf', 'linear']
[2025-10-30 11:04:39] [INFO]   svr__shrinking: [True, False]
[2025-10-30 11:04:39] [INFO]   Total combinaciones: 24
[2025-10-30 11:04:39] [INFO] 
Cross-validation: GroupKFold (n_splits=4)
[2025-10-30 11:04:39] [INFO]   Objetivo: speaker-independent evaluation
[2025-10-30 11:04:39] [INFO]   Métrica: negative MAE
[2025-10-30 11:04:39] [INFO] 
Iniciando GridSearchCV...
[2025-10-30 11:04:39] [INFO]   (esto puede tomar varios minutos)
[2025-10-30 11:05:05] [INFO] 
======================================================================
[2025-10-30 11:05:05] [INFO] GridSearchCV COMPLETADO
[2025-10-30 11:05:05] [INFO] ======================================================================
[2025-10-30 11:05:05] [INFO] Mejores hiperparámetros:
[2025-10-30 11:05:05] [INFO]   svr__C: 10
[2025-10-30 11:05:05] [INFO]   svr__epsilon: 1
[2025-10-30 11:05:05] [INFO]   svr__kernel: rbf
[2025-10-30 11:05:05] [INFO]   svr__shrinking: True
[2025-10-30 11:05:05] [INFO] Mejor MAE (CV): 12.900
[2025-10-30 11:05:05] [INFO] Modelo guardado: model_best_cv.pkl
[2025-10-30 11:05:05] [INFO] Resultados CV guardados: cv_results_full.csv
[2025-10-30 11:05:05] [INFO] 
======================================================================
[2025-10-30 11:05:05] [INFO] PREDICCIONES CROSS-VALIDATION (OUT-OF-FOLD)
[2025-10-30 11:05:05] [INFO] ======================================================================
[2025-10-30 11:05:05] [INFO]   Fold 1/4: train=366, test=123
[2025-10-30 11:05:05] [INFO]   Fold 2/4: train=367, test=122
[2025-10-30 11:05:05] [INFO]   Fold 3/4: train=367, test=122
[2025-10-30 11:05:05] [INFO]   Fold 4/4: train=367, test=122
[2025-10-30 11:05:05] [INFO] Predicciones out-of-fold completadas
[2025-10-30 11:05:05] [INFO] 
======================================================================
[2025-10-30 11:05:05] [INFO] EVALUACIÓN: CV_EN
[2025-10-30 11:05:05] [INFO] ======================================================================
[2025-10-30 11:05:05] [INFO] Métricas continuas:
[2025-10-30 11:05:05] [INFO]   MAE:        12.900
[2025-10-30 11:05:05] [INFO]   RMSE:       19.055
[2025-10-30 11:05:05] [INFO]   R2:         0.329
[2025-10-30 11:05:05] [INFO]   Pearson r:  0.601 (p=0.0000)
[2025-10-30 11:05:05] [INFO]   Spearman:   0.668 (p=0.0000)
[2025-10-30 11:05:05] [INFO] 
Métricas discretas (enteros [0-100]):
[2025-10-30 11:05:05] [INFO]   Acc@1:  6.75%
[2025-10-30 11:05:05] [INFO]   Acc@5:  30.06%
[2025-10-30 11:05:05] [INFO]   Acc@10: 55.62%
[2025-10-30 11:05:05] [INFO]   Exact:  0.61%
[2025-10-30 11:05:05] [INFO] Métricas guardadas: CV_EN_metrics.csv
[2025-10-30 11:05:05] [INFO] Predicciones guardadas: CV_EN_predictions.csv
[2025-10-30 11:05:05] [INFO] Generando gráficos...
[2025-10-30 11:05:06] [INFO] Gráficos guardados: CV_EN_*.png
[2025-10-30 11:05:06] [INFO] 
======================================================================
[2025-10-30 11:05:06] [INFO] CALIBRACIÓN POST-HOC (Isotonic Regression)
[2025-10-30 11:05:06] [INFO] ======================================================================
[2025-10-30 11:05:06] [INFO] Entrenando calibrador en predicciones CV...
[2025-10-30 11:05:06] [INFO] Calibrador guardado: calibrator.pkl
[2025-10-30 11:05:06] [INFO] 
======================================================================
[2025-10-30 11:05:06] [INFO] EVALUACIÓN: CV_EN_CALIBRATED
[2025-10-30 11:05:06] [INFO] ======================================================================
[2025-10-30 11:05:06] [INFO] Métricas continuas:
[2025-10-30 11:05:06] [INFO]   MAE:        13.017
[2025-10-30 11:05:06] [INFO]   RMSE:       18.079
[2025-10-30 11:05:06] [INFO]   R2:         0.396
[2025-10-30 11:05:06] [INFO]   Pearson r:  0.629 (p=0.0000)
[2025-10-30 11:05:06] [INFO]   Spearman:   0.687 (p=0.0000)
[2025-10-30 11:05:06] [INFO] 
Métricas discretas (enteros [0-100]):
[2025-10-30 11:05:06] [INFO]   Acc@1:  3.89%
[2025-10-30 11:05:06] [INFO]   Acc@5:  25.97%
[2025-10-30 11:05:06] [INFO]   Acc@10: 49.90%
[2025-10-30 11:05:06] [INFO]   Exact:  0.61%
[2025-10-30 11:05:06] [INFO] Métricas guardadas: CV_EN_CALIBRATED_metrics.csv
[2025-10-30 11:05:06] [INFO] Predicciones guardadas: CV_EN_CALIBRATED_predictions.csv
[2025-10-30 11:05:06] [INFO] Generando gráficos...
[2025-10-30 11:05:07] [INFO] Gráficos guardados: CV_EN_CALIBRATED_*.png
[2025-10-30 11:05:07] [INFO] 
======================================================================
[2025-10-30 11:05:07] [INFO] ENTRENAMIENTO MODELO FINAL (TODO EN)
[2025-10-30 11:05:07] [INFO] ======================================================================
[2025-10-30 11:05:07] [INFO] Reentrenando modelo en TODO el set EN...
[2025-10-30 11:05:07] [INFO] Modelo final guardado: model_final_all_EN.pkl
[2025-10-30 11:05:07] [INFO] 
======================================================================
[2025-10-30 11:05:07] [INFO] EVALUACIÓN IN-SAMPLE (EN)
[2025-10-30 11:05:07] [INFO] ======================================================================
[2025-10-30 11:05:07] [INFO] Predicciones in-sample (diagnóstico, no evaluación real)...
[2025-10-30 11:05:07] [INFO] 
======================================================================
[2025-10-30 11:05:07] [INFO] EVALUACIÓN: EN_IN_RAW
[2025-10-30 11:05:07] [INFO] ======================================================================
[2025-10-30 11:05:07] [INFO] Métricas continuas:
[2025-10-30 11:05:07] [INFO]   MAE:        10.354
[2025-10-30 11:05:07] [INFO]   RMSE:       17.010
[2025-10-30 11:05:07] [INFO]   R2:         0.465
[2025-10-30 11:05:07] [INFO]   Pearson r:  0.704 (p=0.0000)
[2025-10-30 11:05:07] [INFO]   Spearman:   0.769 (p=0.0000)
[2025-10-30 11:05:07] [INFO] 
Métricas discretas (enteros [0-100]):
[2025-10-30 11:05:07] [INFO]   Acc@1:  15.34%
[2025-10-30 11:05:07] [INFO]   Acc@5:  46.01%
[2025-10-30 11:05:07] [INFO]   Acc@10: 65.85%
[2025-10-30 11:05:07] [INFO]   Exact:  0.82%
[2025-10-30 11:05:07] [INFO] Métricas guardadas: EN_IN_RAW_metrics.csv
[2025-10-30 11:05:07] [INFO] Predicciones guardadas: EN_IN_RAW_predictions.csv
[2025-10-30 11:05:07] [INFO] Generando gráficos...
[2025-10-30 11:05:08] [INFO] Gráficos guardados: EN_IN_RAW_*.png
[2025-10-30 11:05:08] [INFO] 
======================================================================
[2025-10-30 11:05:08] [INFO] EVALUACIÓN: EN_IN_CALIBRATED
[2025-10-30 11:05:08] [INFO] ======================================================================
[2025-10-30 11:05:08] [INFO] Métricas continuas:
[2025-10-30 11:05:08] [INFO]   MAE:        11.444
[2025-10-30 11:05:08] [INFO]   RMSE:       16.458
[2025-10-30 11:05:08] [INFO]   R2:         0.499
[2025-10-30 11:05:08] [INFO]   Pearson r:  0.708 (p=0.0000)
[2025-10-30 11:05:08] [INFO]   Spearman:   0.772 (p=0.0000)
[2025-10-30 11:05:08] [INFO] 
Métricas discretas (enteros [0-100]):
[2025-10-30 11:05:08] [INFO]   Acc@1:  3.68%
[2025-10-30 11:05:08] [INFO]   Acc@5:  30.67%
[2025-10-30 11:05:08] [INFO]   Acc@10: 60.74%
[2025-10-30 11:05:08] [INFO]   Exact:  0.41%
[2025-10-30 11:05:08] [INFO] Métricas guardadas: EN_IN_CALIBRATED_metrics.csv
[2025-10-30 11:05:08] [INFO] Predicciones guardadas: EN_IN_CALIBRATED_predictions.csv
[2025-10-30 11:05:08] [INFO] Generando gráficos...
[2025-10-30 11:05:10] [INFO] Gráficos guardados: EN_IN_CALIBRATED_*.png
[2025-10-30 11:05:10] [WARNING] No hay pacientes ES para evaluación
[2025-10-30 11:05:10] [WARNING] No hay pacientes CA para evaluación
[2025-10-30 11:05:10] [INFO] 
======================================================================
[2025-10-30 11:05:10] [INFO] RESUMEN FINAL
[2025-10-30 11:05:10] [INFO] ======================================================================
[2025-10-30 11:05:10] [INFO] 
Directorio de resultados: /lhome/ext/upc150/upc1503/afasia_cat/codigos_julio2025/resultados_svr/SVR_DEN_DYS_20251030_110439
[2025-10-30 11:05:10] [INFO] 
Pacientes procesados:
[2025-10-30 11:05:10] [INFO]   EN (train):               489
[2025-10-30 11:05:10] [INFO]   ES (internal validation): 0
[2025-10-30 11:05:10] [INFO]   CA (external test):       0
[2025-10-30 11:05:10] [INFO]   TOTAL:                    489
[2025-10-30 11:05:10] [INFO] 
Features utilizadas:
[2025-10-30 11:05:10] [INFO]   DEN: 18
[2025-10-30 11:05:10] [INFO]   DYS: 10
[2025-10-30 11:05:10] [INFO]   TOTAL: 28
[2025-10-30 11:05:10] [INFO] 
Métricas CV (calibrado):
[2025-10-30 11:05:10] [INFO]   MAE:        13.017
[2025-10-30 11:05:10] [INFO]   R2:         0.396
[2025-10-30 11:05:10] [INFO]   Spearman:   0.687
[2025-10-30 11:05:10] [INFO]   Acc@5:      26.0%
[2025-10-30 11:05:10] [INFO] 
======================================================================
[2025-10-30 11:05:10] [INFO] PROCESO COMPLETADO EXITOSAMENTE
[2025-10-30 11:05:10] [INFO] ======================================================================
[2025-10-30 11:05:10] [INFO] Timestamp: 2025-10-30 11:05:10
[2025-10-30 11:05:10] [INFO] Resultados en: /lhome/ext/upc150/upc1503/afasia_cat/codigos_julio2025/resultados_svr/SVR_DEN_DYS_20251030_110439
[2025-10-30 11:05:10] [INFO] ======================================================================

